<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Pro Poker Experience</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap');

        :root {
            --card-w: 90px;
            --card-h: 126px;
            --table-green: #2e7d32;
            --felt-texture: radial-gradient(circle at center, #388e3c 0%, #1b5e20 100%);
        }

        body {
            margin: 0;
            background: #111;
            font-family: 'Roboto Condensed', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            color: white;
        }

        /* --- MASA TASARIMI --- */
        #poker-table {
            width: 90%;
            max-width: 900px;
            height: 600px;
            background: var(--felt-texture);
            border: 15px solid #3e2723; /* Ahşap kenar */
            border-radius: 200px;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.8), 0 0 50px rgba(0,0,0,0.5);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 40px;
            perspective: 1000px; /* 3D efekt için derinlik */
        }

        /* --- KART ALANLARI --- */
        .hand-container {
            height: 160px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .badge {
            position: absolute;
            left: 20px;
            background: rgba(0,0,0,0.6);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 1px;
        }

        /* --- 3D KART YAPISI --- */
        .card-wrapper {
            width: var(--card-w);
            height: var(--card-h);
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.2s, margin-top 0.2s;
        }

        /* Kartın İçindeki Dönen Parça */
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Yaylanma Efekti */
            transform-style: preserve-3d;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        /* Kart Seçilince Yukarı Çıksın */
        .card-wrapper.selected {
            margin-top: -40px;
        }
        .card-wrapper.selected .card-inner {
            box-shadow: 0 0 15px #f1c40f; /* Altın Işık */
            border: 1px solid #f1c40f;
        }

        /* Kart Çevrilince (CPU için) */
        .card-wrapper.flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* Ön ve Arka Yüzler */
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Arkası dönükken gizle */
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            box-sizing: border-box;
            background: white;
        }

        .card-back {
            background: repeating-linear-gradient(45deg, #c0392b, #c0392b 10px, #a93226 10px, #a93226 20px);
            border: 2px solid #fff;
            transform: rotateY(0deg); /* Arka yüz varsayılan */
        }

        .card-front {
            transform: rotateY(180deg); /* Ön yüz başlangıçta arkada */
            color: #333;
        }

        .card-front.red { color: #e74c3c; }
        .card-front.black { color: #2c3e50; }

        .rank-big { font-size: 2rem; }
        .suit-big { font-size: 3rem; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.2; }

        /* --- ANİMASYON: DAĞITMA (FLY IN) --- */
        @keyframes flyIn {
            0% { transform: translateY(-500px) scale(0.5); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .anim-enter {
            animation: flyIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* --- KONTROLLER --- */
        .center-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            pointer-events: none; /* Tıklamaları altta kalanlara iletmesin */
        }

        .btn-main {
            pointer-events: auto;
            background: linear-gradient(to bottom, #f1c40f, #f39c12);
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            color: #4e342e;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            transition: transform 0.1s, filter 0.2s;
            font-family: 'Roboto Condensed', sans-serif;
            text-transform: uppercase;
        }

        .btn-main:hover { filter: brightness(1.1); transform: scale(1.05); }
        .btn-main:active { transform: scale(0.95); }

        #game-message {
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            opacity: 0;
            transition: opacity 0.5s;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 10px;
        }
        #game-message.visible { opacity: 1; }

    </script>
</head>
<body>

    <div id="poker-table">
        <div class="hand-container" id="cpu-hand">
            <div class="badge">CPU</div>
        </div>

        <div class="center-area">
            <div id="game-message">Texas Hold'em</div>
            <button class="btn-main" id="action-btn" onclick="startGame()">DEAL</button>
        </div>

        <div class="hand-container" id="player-hand">
            <div class="badge">YOU</div>
        </div>
    </div>

    <script>
        // --- SES MOTORU (Daha tok sesler) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            const now = audioCtx.currentTime;
            
            if(type === 'deal') {
                // Kart sesi (Hışır)
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
            } else if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.05);
            } else if (type === 'win') {
                // Zafer akoru
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now); // La
                osc.frequency.setValueAtTime(554, now + 0.1); // Do#
                osc.frequency.setValueAtTime(659, now + 0.2); // Mi
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.6);
            }
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(now + 1);
        }

        // --- OYUN DEĞİŞKENLERİ ---
        const SUITS = ['♥', '♠', '♦', '♣'];
        const RANKS = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        let deck = [], playerHand = [], cpuHand = [];
        let state = 'IDLE';

        // --- HTML ELEMENTLERİ ---
        const elPlayer = document.getElementById('player-hand');
        const elCpu = document.getElementById('cpu-hand');
        const btn = document.getElementById('action-btn');
        const msg = document.getElementById('game-message');

        // --- ÇEKİRDEK FONKSİYONLAR ---
        
        function createDeck() {
            deck = [];
            SUITS.forEach(s => {
                RANKS.forEach((r, i) => {
                    deck.push({ 
                        suit: s, 
                        rank: r, 
                        val: i + 6, 
                        id: Math.random().toString(36),
                        selected: false 
                    });
                });
            });
            // Fisher-Yates Shuffle
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function startGame() {
            playSound('click');
            createDeck();
            playerHand = [];
            cpuHand = [];
            
            // El temizle
            elPlayer.innerHTML = '<div class="badge">YOU</div>';
            elCpu.innerHTML = '<div class="badge">CPU</div>';
            msg.classList.remove('visible');

            // 5 Kart Dağıt
            for(let i=0; i<5; i++) {
                playerHand.push(deck.pop());
                cpuHand.push(deck.pop());
            }
            
            sortHand(playerHand);
            
            // Kartları teker teker oluştur (Animasyon için gecikmeli)
            playerHand.forEach((c, i) => {
                setTimeout(() => addCardToDom(c, 'player', true), i * 100);
                setTimeout(() => playSound('deal'), i * 100);
            });
            
            cpuHand.forEach((c, i) => {
                setTimeout(() => addCardToDom(c, 'cpu', false), i * 100 + 500);
            });

            state = 'SWAP';
            setTimeout(() => {
                setMessage("Select cards to swap");
                btn.innerText = "DRAW CARDS";
                btn.onclick = swapCards;
            }, 1000);
        }

        // Kart DOM Oluşturucu (3D Yapısı)
        function addCardToDom(card, owner, faceUp) {
            const wrapper = document.createElement('div');
            wrapper.className = 'card-wrapper anim-enter';
            if(faceUp) wrapper.classList.add('flipped'); // Oyuncu kartları direkt dönük gelir
            wrapper.id = card.id;

            // Renk belirle
            const isRed = card.suit === '♥' || card.suit === '♦';
            const colorClass = isRed ? 'red' : 'black';

            wrapper.innerHTML = `
                <div class="card-inner">
                    <div class="card-back"></div>
                    <div class="card-front ${colorClass}">
                        <div style="font-size:20px; text-align:left;">${card.rank}<br>${card.suit}</div>
                        <div class="suit-big">${card.suit}</div>
                        <div style="font-size:20px; text-align:right; transform:rotate(180deg);">${card.rank}<br>${card.suit}</div>
                    </div>
                </div>
            `;

            // Tıklama olayı (Sadece oyuncu için)
            if(owner === 'player') {
                wrapper.onclick = () => {
                    if(state !== 'SWAP') return;
                    playSound('click');
                    card.selected = !card.selected;
                    wrapper.classList.toggle('selected');
                };
                elPlayer.appendChild(wrapper);
            } else {
                elCpu.appendChild(wrapper);
            }
        }

        function swapCards() {
            playSound('click');
            // 1. Seçili kartları animasyonla sil
            const selectedEls = document.querySelectorAll('.selected');
            selectedEls.forEach(el => {
                el.style.transform = "translateY(-100px) scale(0)";
                el.style.opacity = "0";
            });

            // Veri güncelleme
            setTimeout(() => {
                // Oyuncu
                playerHand = playerHand.filter(c => !c.selected);
                while(playerHand.length < 5) playerHand.push(deck.pop());
                sortHand(playerHand);
                
                // CPU (Basit AI: Çifti yoksa 2 kart değiştir)
                if(!hasPair(cpuHand)) {
                    cpuHand.pop(); cpuHand.pop();
                    cpuHand.push(deck.pop()); cpuHand.push(deck.pop());
                }

                // Yeniden Çiz
                refreshPlayerDom();
                
                state = 'SHOWDOWN';
                btn.innerText = "SHOWDOWN";
                btn.onclick = revealWinner;
                setMessage("Ready to reveal?");
            }, 300);
        }

        function refreshPlayerDom() {
            elPlayer.innerHTML = '<div class="badge">YOU</div>';
            playerHand.forEach((c, i) => {
                addCardToDom(c, 'player', true); // Yeniden çizilenler açık gelir
            });
        }

        function revealWinner() {
            playSound('click');
            // CPU Kartlarını Döndür (Flip Efekti)
            const cpuDivs = elCpu.querySelectorAll('.card-wrapper');
            
            // CPU DOM ile CPU Data'yı eşleştirmek gerekmez, sırayla güncelliyoruz
            // Ancak burada görsel olarak 'flipped' class'ı eklemek yeterli
            // Çünkü iç HTML'i henüz yazmadık (CPU kartları baştan kapalıydı ve içi boştu veya gizliydi)
            
            // Doğrusu: CPU kartlarının 'front' yüzünü güncelle ve class ekle.
            cpuHand.forEach((c, i) => {
                const wrapper = cpuDivs[i];
                const isRed = c.suit === '♥' || c.suit === '♦';
                const colorClass = isRed ? 'red' : 'black';
                
                // İçeriği güncelle (Hile yapıp HTML inject ediyoruz)
                const frontDiv = wrapper.querySelector('.card-front');
                frontDiv.className = `card-front ${colorClass}`;
                frontDiv.innerHTML = `
                    <div style="font-size:20px; text-align:left;">${c.rank}<br>${c.suit}</div>
                    <div class="suit-big">${c.suit}</div>
                    <div style="font-size:20px; text-align:right; transform:rotate(180deg);">${c.rank}<br>${c.suit}</div>
                `;
                
                setTimeout(() => {
                    wrapper.classList.add('flipped');
                    playSound('deal');
                }, i * 200);
            });

            setTimeout(() => {
                const pRes = evaluateHand(playerHand);
                const cRes = evaluateHand(cpuHand);
                
                let resultText = "";
                if(pRes.score > cRes.score) {
                    resultText = `<span style="color:#4caf50">YOU WIN!</span><br><small>${pRes.name} vs ${cRes.name}</small>`;
                    playSound('win');
                } else if (cRes.score > pRes.score) {
                    resultText = `<span style="color:#e57373">CPU WINS</span><br><small>${cRes.name} beats ${pRes.name}</small>`;
                } else {
                    resultText = "DRAW!";
                }
                
                setMessage(resultText);
                btn.innerText = "PLAY AGAIN";
                btn.onclick = startGame;
            }, 1500);
        }

        function setMessage(text) {
            msg.innerHTML = text;
            msg.classList.add('visible');
        }

        // --- POKER MANTIĞI (English Terms) ---
        function sortHand(h) { h.sort((a,b) => a.val - b.val); }
        
        function hasPair(h) {
            const counts = {};
            h.forEach(c => counts[c.val] = (counts[c.val] || 0) + 1);
            return Object.values(counts).some(v => v >= 2);
        }

        function evaluateHand(hand) {
            let vals = hand.map(c => c.val).sort((a,b) => a-b);
            let suits = hand.map(c => c.suit);
            let counts = {};
            vals.forEach(x => counts[x] = (counts[x] || 0) + 1);
            let vCounts = Object.values(counts);
            
            const isFlush = suits.every(s => s === suits[0]);
            let isStraight = true;
            for(let i=0; i<4; i++) { if(vals[i+1] !== vals[i]+1) isStraight = false; }
            if(!isStraight && vals[0]===10 && vals[4]===14) isStraight = true;

            // High Card for tie-breaking logic omitted for brevity, using base score + max card
            const highCard = vals[4];
            
            if(isFlush && isStraight) return { score: 900 + highCard, name: "Straight Flush" };
            if(vCounts.includes(4)) return { score: 800 + highCard, name: "Four of a Kind" };
            if(isFlush) return { score: 700 + highCard, name: "Flush" }; // TR Rule: Flush > Full House
            if(vCounts.includes(3) && vCounts.includes(2)) return { score: 600 + highCard, name: "Full House" };
            if(isStraight) return { score: 500 + highCard, name: "Straight" };
            if(vCounts.includes(3)) return { score: 400 + highCard, name: "Three of a Kind" };
            if(vCounts.filter(x => x===2).length === 2) return { score: 300 + highCard, name: "Two Pair" };
            if(vCounts.includes(2)) return { score: 200 + highCard, name: "Pair" };
            
            return { score: 100 + highCard, name: "High Card" };
        }

    </script>
</body>
</html>
