<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Texas Hold'em - Gemini Tarafƒ±ndan Kodlandƒ±</title>
    <style>
        /* --- CSS TASARIMI --- */
        :root {
            --felt-color: #27ae60;
            --wood-color: #5d4037;
            --gold-color: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c3e50;
            background-image: radial-gradient(circle, #34495e 10%, transparent 10%), radial-gradient(circle, #34495e 10%, transparent 10%);
            background-size: 20px 20px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            user-select: none;
        }

        /* SKOR TABLOSU (YENƒ∞) */
        #stats-board {
            display: flex;
            gap: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 30px;
            border-radius: 15px;
            border: 2px solid var(--gold-color);
            margin-bottom: 10px;
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.3);
            font-size: 1.2rem;
            font-weight: bold;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .money-text { color: #2ecc71; text-shadow: 0 0 5px #2ecc71; }
        .pot-text { color: var(--gold-color); text-shadow: 0 0 5px var(--gold-color); }

        h1 { margin: 5px 0; text-shadow: 2px 2px 4px #000; font-size: 1.8rem;}

        #poker-table {
            background-color: var(--felt-color);
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20.5V18H0v2.5h20zM20 22v-2.5H0V22h20zM40 20.5V18H20v2.5h20zM40 22v-2.5H20V22h20zM20 0v2.5H0V0h20zM20 1.5V4H0V1.5h20zM40 0v2.5H20V0h20zM40 1.5V4H20V1.5h20zM20 40v-2.5H0V40h20zM20 38.5V36H0v2.5h20zM40 40v-2.5H20V40h20zM40 38.5V36H20v2.5h20z' fill='%231e8449' fill-opacity='0.15' fill-rule='evenodd'/%3E%3C/svg%3E");
            border: 12px solid var(--wood-color);
            border-radius: 80px;
            width: 95%;
            max-width: 700px;
            height: 450px;
            position: relative;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5), 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 15px;
            perspective: 1000px;
        }

        .hand-area, .community-area {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .community-area {
            background-color: rgba(0,0,0,0.15);
            border-radius: 50px;
            padding: 5px 20px;
            margin: 0 auto;
            border: 2px solid rgba(255,255,255,0.1);
            min-width: 300px;
        }

        /* KART STƒ∞LLERƒ∞ */
        .card-container {
            width: 60px;
            height: 90px;
            margin: 0 4px;
            position: relative;
            animation: dealCard 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            opacity: 0;
            transform: translateY(-200px) rotate(720deg);
        }

        @keyframes dealCard { to { opacity: 1; transform: translateY(0) rotate(0deg); } }

        .card {
            width: 100%; height: 100%;
            background-color: #ecf0f1; border-radius: 6px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            font-weight: bold; font-size: 18px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            position: absolute; top: 0; left: 0;
            backface-visibility: hidden; transition: transform 0.6s;
        }

        .card-face { z-index: 2; transform: rotateY(0deg); }
        .card.red { color: #c0392b; }
        .card.black { color: #2c3e50; }
        .card-back {
            z-index: 1;
            background: repeating-linear-gradient(45deg, #c0392b, #c0392b 5px, #e74c3c 5px, #e74c3c 10px);
            border: 3px solid white; transform: rotateY(180deg);
        }

        .reveal-card .card-back { transform: rotateY(0deg); z-index: 0; }
        .reveal-card .card-face { transform: rotateY(-180deg); z-index: 3; }

        /* KONTROLLER */
        #controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 24px; font-size: 16px; cursor: pointer;
            border-radius: 8px; color: white; font-weight: bold;
            transition: all 0.2s; border: none;
            box-shadow: 0 4px rgba(0,0,0,0.3);
        }
        
        button:active { transform: translateY(3px); box-shadow: 0 1px rgba(0,0,0,0.3); }
        button:hover:not(:disabled) { filter: brightness(1.1); }
        button:disabled { background: #7f8c8d !important; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7;}

        .btn-deal { background: linear-gradient(to bottom, #2ecc71, #27ae60); }
        .btn-check { background: linear-gradient(to bottom, #3498db, #2980b9); }
        .btn-raise { background: linear-gradient(to bottom, #f1c40f, #f39c12); color: #4e342e; }
        .btn-fold { background: linear-gradient(to bottom, #e74c3c, #c0392b); }

        #status-msg {
            font-size: 1.1em; margin-bottom: 10px;
            background: rgba(0,0,0,0.7); padding: 8px 20px;
            border-radius: 20px; min-width: 250px; text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .label {
            position: absolute; color: rgba(255,255,255,0.6);
            font-size: 11px; text-transform: uppercase;
            letter-spacing: 1px; background: rgba(0,0,0,0.3);
            padding: 2px 5px; border-radius: 4px;
        }
        #cpu-label { top: 10px; left: 50%; transform: translateX(-50%); }
        #player-label { bottom: 10px; left: 50%; transform: translateX(-50%); }

        /* √áip animasyonu i√ßin (opsiyonel basit efekt) */
        .chip-change { animation: flash 0.5s; }
        @keyframes flash { 0% { color: white; } 50% { color: #f1c40f; transform: scale(1.2); } 100% { color: inherit; } }

    </style>
</head>
<body>

    <h1>Casino Texas Hold'em</h1>

    <div id="stats-board">
        <div class="stat-item">
            <span>üí∞ Bakiye:</span>
            <span id="player-chips" class="money-text">$1000</span>
        </div>
        <div class="stat-item" style="border-left: 1px solid rgba(255,255,255,0.3); padding-left: 20px;">
            <span>üèÜ Pot:</span>
            <span id="current-pot" class="pot-text">$0</span>
        </div>
    </div>
    
    <div id="status-msg">Bahisler a√ßƒ±ldƒ±! Ba≈ülamak i√ßin 'Daƒüƒ±t' butonuna bas.</div>

    <div id="poker-table">
        <div id="cpu-label" class="label">Bilgisayar</div>
        <div id="cpu-hand" class="hand-area"></div>
        <div id="community-cards" class="community-area"></div>
        <div id="player-hand" class="hand-area"></div>
        <div id="player-label" class="label">Senin Elin</div>
    </div>

    <div id="controls">
        <button id="btn-deal" class="btn-deal" onclick="startGame()">Daƒüƒ±t ($50)</button>
        <button id="btn-check" class="btn-check" onclick="nextStep(false)" disabled>G√∂r (Check)</button>
        <button id="btn-raise" class="btn-raise" onclick="nextStep(true)" disabled>Artƒ±r (+$100)</button>
        <button id="btn-fold" class="btn-fold" onclick="fold()" disabled>Pas (Fold)</button>
    </div>

    <script>
        /* --- SES MOTORU (WEB AUDIO API) --- */
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playTone(freq, type, duration, delay = 0) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + delay);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime + delay);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + delay + duration);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + delay);
            osc.stop(audioCtx.currentTime + delay + duration);
        }

        function playNoise(duration) {
            if (!audioCtx) return;
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const gainNode = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1000;
            gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            noise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            noise.start();
        }

        const sounds = {
            click: () => playTone(800, 'sine', 0.1),
            deal: () => playNoise(0.15),
            chip: () => playTone(1200, 'triangle', 0.05), // √áip sesi
            win: () => {
                playTone(523.25, 'triangle', 0.3, 0);
                playTone(659.25, 'triangle', 0.3, 0.1);
                playTone(783.99, 'triangle', 0.6, 0.2);
            },
            lose: () => {
                playTone(200, 'sawtooth', 0.5, 0);
                playTone(150, 'sawtooth', 0.8, 0.3);
            }
        };

        /* --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ --- */
        const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        
        let deck = [];
        let playerHand = [];
        let cpuHand = [];
        let communityCards = [];
        let stage = 0;
        let cpuCardElements = []; 

        // BAHƒ∞S Sƒ∞STEMƒ∞ DEƒûƒ∞≈ûKENLERƒ∞
        let playerChips = 1000;
        let pot = 0;
        const ANTE_AMOUNT = 50;
        const RAISE_AMOUNT = 100;

        function updateUI() {
            const chipsEl = document.getElementById('player-chips');
            const potEl = document.getElementById('current-pot');
            
            chipsEl.innerText = '$' + playerChips;
            potEl.innerText = '$' + pot;

            // Animasyon sƒ±nƒ±fƒ±nƒ± tetikle
            chipsEl.classList.remove('chip-change');
            potEl.classList.remove('chip-change');
            void chipsEl.offsetWidth; // Reflow tetikle
            chipsEl.classList.add('chip-change');
            potEl.classList.add('chip-change');
        }

        function createDeck() {
            deck = [];
            for (let s of suits) {
                for (let v of values) {
                    deck.push({ suit: s, value: v, weight: values.indexOf(v) + 2 });
                }
            }
        }

        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function createCardHTML(card, isCpu = false) {
            const container = document.createElement('div');
            container.className = 'card-container';
            container.style.animationDelay = `${Math.random() * 0.2}s`;

            const cardFace = document.createElement('div');
            cardFace.className = 'card card-face';
            if (card.suit === '‚ô•' || card.suit === '‚ô¶') cardFace.classList.add('red');
            else cardFace.classList.add('black');
            cardFace.innerHTML = `<div>${card.value}</div><div>${card.suit}</div>`;

            const cardBack = document.createElement('div');
            cardBack.className = 'card card-back';

            container.appendChild(cardBack);
            container.appendChild(cardFace);
            
            if (isCpu) {
                container.classList.add('reveal-card');
                cpuCardElements.push(container);
            }
            return container;
        }

        async function dealCardsWithAnimation(cards, targetElement, isCpu = false) {
            targetElement.innerHTML = '';
            for (const card of cards) {
                const cardEl = createCardHTML(card, isCpu);
                targetElement.appendChild(cardEl);
                sounds.deal();
                await new Promise(r => setTimeout(r, 200));
            }
        }

        async function startGame() {
            initAudio();
            
            if (playerChips < ANTE_AMOUNT) {
                updateStatus("Bakiye yetersiz! Oyun Bitti. (Sayfayƒ± yenile)");
                return;
            }

            // BAHƒ∞S KESƒ∞NTƒ∞Sƒ∞ (ANTE)
            playerChips -= ANTE_AMOUNT;
            pot = ANTE_AMOUNT * 2; // Oyuncu + CPU
            updateUI();
            sounds.chip();

            updateStatus("Ante ($50) √∂dendi. Kartlar daƒüƒ±tƒ±lƒ±yor...");
            document.getElementById('btn-deal').disabled = true;
            toggleGameButtons(false);
            
            createDeck();
            shuffleDeck();
            playerHand = [deck.pop(), deck.pop()];
            cpuHand = [deck.pop(), deck.pop()];
            communityCards = [];
            cpuCardElements = [];
            stage = 1;

            document.getElementById('community-cards').innerHTML = '';

            await dealCardsWithAnimation(playerHand, document.getElementById('player-hand'), false);
            await dealCardsWithAnimation(cpuHand, document.getElementById('cpu-hand'), true);

            updateStatus("Sƒ±ra sende: G√∂r veya Artƒ±r?");
            toggleGameButtons(true);
            document.getElementById('btn-deal').innerText = "Oyun S√ºr√ºyor...";
        }

        // nextStep Artƒ±k bir 'isRaise' parametresi alƒ±yor
        async function nextStep(isRaise) {
            initAudio();
            toggleGameButtons(false);

            // BAHƒ∞S MANTIƒûI
            if (isRaise) {
                if (playerChips >= RAISE_AMOUNT) {
                    playerChips -= RAISE_AMOUNT;
                    pot += RAISE_AMOUNT * 2; // Sen artƒ±rdƒ±n, CPU g√∂rd√º
                    updateUI();
                    sounds.chip();
                    updateStatus("Artƒ±rdƒ±n! CPU g√∂rd√º (+$200 Pota).");
                } else {
                    updateStatus("Yetersiz bakiye! Mecburen Check yapƒ±ldƒ±.");
                }
            } else {
                sounds.click();
            }
            
            // K√º√ß√ºk bir bekleme
            await new Promise(r => setTimeout(r, 500));

            let newCards = [];
            if (stage === 1) { // Flop
                newCards = [deck.pop(), deck.pop(), deck.pop()];
                stage = 2;
                updateStatus(isRaise ? "Bahisler alƒ±ndƒ±. Flop a√ßƒ±lƒ±yor..." : "Flop a√ßƒ±lƒ±yor...");
            } else if (stage === 2) { // Turn
                newCards = [deck.pop()];
                stage = 3;
                updateStatus("Turn kartƒ± geliyor...");
            } else if (stage === 3) { // River
                newCards = [deck.pop()];
                stage = 4;
                document.getElementById('btn-check').innerText = "Elleri A√ß";
                document.getElementById('btn-raise').disabled = true; // Sonda artƒ±rma kapalƒ± olsun basitle≈ütirmek i√ßin
                updateStatus("Son kart (River) a√ßƒ±lƒ±yor!");
            } else if (stage === 4) { // Showdown
                determineWinner();
                stage = 5;
                return;
            }

            communityCards.push(...newCards);
            const communityDiv = document.getElementById('community-cards');
            for (const card of newCards) {
                const cardEl = createCardHTML(card);
                communityDiv.appendChild(cardEl);
                sounds.deal();
                await new Promise(r => setTimeout(r, 250));
            }

            if(stage < 5) {
                 toggleGameButtons(true);
                 if(stage === 4) {
                     // Son a≈üamada sadece Elleri A√ß butonu aktif kalsƒ±n, artƒ±rmayƒ± kapatalƒ±m (isteƒüe baƒülƒ±)
                     document.getElementById('btn-raise').disabled = true;
                     document.getElementById('btn-check').innerText = "Elleri A√ß";
                 } else {
                     updateStatus("Sƒ±ra sende: G√∂r veya Artƒ±r?");
                 }
            }
        }

        function fold() {
            initAudio();
            sounds.lose();
            updateStatus("Pas ge√ßtiniz. Potu Bilgisayar kazandƒ±.");
            revealCpuCards();
            endGame(false); // Kaybetme durumu
        }

        function revealCpuCards() {
            cpuCardElements.forEach(container => {
                container.classList.remove('reveal-card');
            });
        }

        function calculateHandStrength(hand, community) {
            const allCards = hand.concat(community);
            allCards.sort((a, b) => b.weight - a.weight);
            let score = 0;
            let counts = {};
            let suitsCount = {};

            allCards.forEach(card => {
                score += card.weight;
                counts[card.value] = (counts[card.value] || 0) + 1;
                suitsCount[card.suit] = (suitsCount[card.suit] || 0) + 1;
            });
            for (let val in counts) {
                if (counts[val] === 2) score += 100;
                if (counts[val] === 3) score += 300;
                if (counts[val] === 4) score += 700;
            }
            for (let suit in suitsCount) {
                if (suitsCount[suit] >= 5) score += 500;
            }
            return score;
        }

        async function determineWinner() {
            updateStatus("Eller a√ßƒ±lƒ±yor...");
            
            for(let i = 0; i < cpuCardElements.length; i++) {
                 cpuCardElements[i].classList.remove('reveal-card');
                 sounds.deal();
                 await new Promise(r => setTimeout(r, 300));
            }

            const playerScore = calculateHandStrength(playerHand, communityCards);
            const cpuScore = calculateHandStrength(cpuHand, communityCards);

            if (playerScore > cpuScore) {
                endGame(true); // KAZANDIN
            } else if (cpuScore > playerScore) {
                endGame(false); // KAYBETTƒ∞N
            } else {
                endGame(null); // BERABERE
            }
        }

        function endGame(playerWon) {
            let msg = "";
            
            if (playerWon === true) {
                msg = `KAZANDIN! Pot ($${pot}) senin oldu! üéâ`;
                document.getElementById('status-msg').style.backgroundColor = "#27ae60";
                playerChips += pot;
                setTimeout(() => sounds.win(), 500);
            } else if (playerWon === false) {
                msg = "KAYBETTƒ∞N. Pot Bilgisayara gitti. üòî";
                document.getElementById('status-msg').style.backgroundColor = "#c0392b";
                setTimeout(() => sounds.lose(), 500);
            } else {
                msg = "BERABERE! Pot b√∂l√º≈ü√ºld√º. ü§ù";
                playerChips += (pot / 2);
                sounds.click();
            }
            
            pot = 0;
            updateUI();
            updateStatus(msg);

            document.getElementById('btn-deal').disabled = false;
            document.getElementById('btn-deal').innerText = "Yeni El Daƒüƒ±t ($50)";
            toggleGameButtons(false);
            document.getElementById('btn-check').innerText = "G√∂r (Check)";
            
            // Eƒüer para bittiyse
            if (playerChips < ANTE_AMOUNT) {
                setTimeout(() => alert("Bakiye Bitti! Sayfayƒ± yenileyerek tekrar ba≈ülayabilirsin."), 1000);
                document.getElementById('btn-deal').disabled = true;
                document.getElementById('btn-deal').innerText = "GAME OVER";
            }
        }

        function updateStatus(msg) {
            document.getElementById('status-msg').innerText = msg;
            if(!msg.includes("KAZANDIN") && !msg.includes("KAYBETTƒ∞N")) {
                document.getElementById('status-msg').style.backgroundColor = "rgba(0,0,0,0.7)";
            }
        }

        function toggleGameButtons(active) {
            document.getElementById('btn-check').disabled = !active;
            document.getElementById('btn-raise').disabled = !active;
            document.getElementById('btn-fold').disabled = !active;
        }

    </script>
</body>
</html>
