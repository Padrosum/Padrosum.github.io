<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>3D Dünya ve Saat Dilimleri</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
        canvas { display: block; }
        
        /* Saat etiketi stili */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffcc;
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #00ffcc;
            pointer-events: none; /* Mouse olaylarını engellememesi için */
            display: none;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
            z-index: 10;
        }
        
        #info {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: white;
            pointer-events: none;
            text-shadow: 0 0 5px black;
        }
    </style>
</head>
<body>

<div id="info">
    <h2>3D Dünya Saat Hesaplayıcı</h2>
    <p>Dünya üzerinde gezinerek yerel saati (tahmini) görebilirsin.<br>Döndürmek için tıkla ve sürükle.</p>
</div>
<div id="tooltip"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
    // --- 1. KURULUM ---
    const scene = new THREE.Scene();
    
    // Kamera ayarları
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 2.5; // Kamerayı biraz geriye çekiyoruz

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Mouse kontrolleri (OrbitControls)
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 1.5;
    controls.maxDistance = 4;

    // --- 2. DÜNYA OLUŞTURMA ---
    // Gerçekçi bir görünüm için doku yüklüyoruz
    const textureLoader = new THREE.TextureLoader();
    const earthGeometry = new THREE.SphereGeometry(1, 64, 64);
    
    // Dünya materyali
    const earthMaterial = new THREE.MeshPhongMaterial({
        map: textureLoader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg'),
        bumpMap: textureLoader.load('https://unpkg.com/three-globe/example/img/earth-topology.png'),
        bumpScale: 0.05,
        specularMap: textureLoader.load('https://unpkg.com/three-globe/example/img/earth-water.png'),
        specular: new THREE.Color('grey')
    });

    const earth = new THREE.Mesh(earthGeometry, earthMaterial);
    scene.add(earth);

    // --- 3. IŞIKLANDIRMA ---
    const ambientLight = new THREE.AmbientLight(0x333333);
    scene.add(ambientLight);

    const sunLight = new THREE.DirectionalLight(0xffffff, 1);
    sunLight.position.set(5, 3, 5);
    scene.add(sunLight);

    // Arka plana yıldızlar ekleyelim (Basit versiyon)
    const starGeometry = new THREE.BufferGeometry();
    const starCount = 1000;
    const starPos = new Float32Array(starCount * 3);
    for(let i=0; i<starCount*3; i++) {
        starPos[i] = (Math.random() - 0.5) * 100;
    }
    starGeometry.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
    const starMaterial = new THREE.PointsMaterial({color: 0xffffff, size: 0.1});
    const stars = new THREE.Points(starGeometry, starMaterial);
    scene.add(stars);

    // --- 4. ETKİLEŞİM (RAYCASTING) VE SAAT HESAPLAMA ---
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    const tooltip = document.getElementById('tooltip');

    function onMouseMove(event) {
        // Mouse koordinatlarını -1 ile +1 arasına normalize et
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        // Tooltip pozisyonunu güncelle
        tooltip.style.left = event.clientX + 15 + 'px';
        tooltip.style.top = event.clientY + 15 + 'px';
    }

    // Boylamdan saat hesaplama fonksiyonu
    function calculateTime(longitude) {
        // Dünya 360 derece, 24 saat dilimi var. Her 15 derece = 1 saat.
        const offset = Math.round(longitude / 15);
        
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const targetTime = new Date(utc + (3600000 * offset));
        
        // GMT formatı oluşturma (Örn: GMT+3)
        const sign = offset >= 0 ? '+' : '';
        const gmtLabel = `GMT${sign}${offset}`;

        // Saati formatla
        const timeString = targetTime.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});
        
        return `<strong>${timeString}</strong><br><small>${gmtLabel}</small>`;
    }

    function updateInteraction() {
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObject(earth);

        if (intersects.length > 0) {
            const point = intersects[0].point;
            
            // 3D Kesişim noktasını Küresel Koordinatlara (Enlem/Boylam) çevir
            // Three.js koordinat sisteminde Y yukarıdır.
            // Boylam hesabı için X ve Z eksenlerini kullanıyoruz.
            // Math.atan2(z, x) bize radyan cinsinden açıyı verir.
            
            // Texture haritasının başlangıç noktasına göre düzeltme (-Math.PI/2 döndürme gerekebilir texture'a göre)
            // Genelde Three.js sphere texture map'i Z ekseninden başlar.
            
            let longitude = Math.atan2(point.x, point.z) * (180 / Math.PI); // Radyan -> Derece
            
            // Boylamı normalleştir (-180 ile 180 arası)
            // Not: Texture'un nasıl sarıldığına bağlı olarak ufak kaydırmalar gerekebilir.
            // Bu örnekte temel matematiksel yaklaşımı kullanıyoruz.
            
            tooltip.innerHTML = calculateTime(longitude);
            tooltip.style.display = 'block';
            document.body.style.cursor = 'crosshair';
        } else {
            tooltip.style.display = 'none';
            document.body.style.cursor = 'default';
        }
    }

    window.addEventListener('mousemove', onMouseMove, false);

    // Pencere boyutu değişirse güncelle
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // --- 5. ANİMASYON DÖNGÜSÜ ---
    function animate() {
        requestAnimationFrame(animate);
        
        controls.update(); // OrbitControls için gerekli
        updateInteraction(); // Raycasting işlemini her karede yap

        // Dünyayı yavaşça kendi etrafında döndür (Opsiyonel)
        // earth.rotation.y += 0.0005; 

        renderer.render(scene, camera);
    }

    animate();
</script>

</body>
</html>
